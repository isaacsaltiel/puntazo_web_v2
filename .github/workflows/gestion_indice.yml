name: Gestionar índice remoto

on:
  workflow_dispatch:
    inputs:
      loc:
        type: string
        required: true
      can:
        type: string
        required: true
      lado:
        type: string
        required: true

jobs:
  ejecutar:
    runs-on: ubuntu-latest
    env:
      DROPBOX_TOKEN_JSON: ${{ secrets.DROPBOX_TOKEN_JSON }}

    steps:
      - uses: actions/checkout@v3

      - name: Instalar dependencias
        run: |
          sudo apt update
          sudo apt install -y rclone
          pip install dropbox cloudinary requests

      - name: Configurar rclone
        run: |
          mkdir -p ~/.config/rclone
          echo "[dropbox]" > ~/.config/rclone/rclone.conf
          echo "type = dropbox" >> ~/.config/rclone/rclone.conf
          echo "token = ${DROPBOX_TOKEN_JSON}" >> ~/.config/rclone/rclone.conf

      - name: Verificar config de rclone
        run: cat ~/.config/rclone/rclone.conf

      - name: Ejecutar gestión de índice
        run: |
          python gestion_indice_ci.py \
            --loc "${{ github.event.inputs.loc }}" \
            --can "${{ github.event.inputs.can }}" \
            --lado "${{ github.event.inputs.lado }}"
